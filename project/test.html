<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
	<head>
		<title>Inside Effects</title>
		<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />

		<link href="lib/codemirror.css" rel="stylesheet" type="text/css" />
		<link href="src/style.css" rel="stylesheet" type="text/css" />

		<script type="text/javascript" src="lib/codemirror.js"></script>
		<script type="text/javascript" src="lib/mode/javascript.js"></script>
		<script type="text/javascript" src="lib/mode/inside.js"></script>
		<script type="text/javascript" src="lib/ohm.js"></script>
		<script type="text/javascript" src="lib/embed.js"></script>
		<script type="text/javascript" src="src/lang.js"></script>
		<script type="text/javascript" src="src/util.js"></script>
		<script type="text/ohm-js"     src="src/gram.ohm"></script>
	</head>
	<body>
		<h1>Basics</h1>
		<script src="src/main.js">
			# Hello, World
			print ( "hello: " + 123 ) ;

			# Simple functions
			set num = 1;
			set inc = fun -> set num = num + 1;

			print ( "inc:  " + inc() ) ;
			print ( "inc:  " + inc() ) ;
			print ( "num:  " + num   ) ;
		</script>

		<!--
		<h1>Types and arrays</h1>
		<script src="src/main.js">
			print Foo 123;
		</script>
		-->

		<!--
		<h1>Types and arrays</h1>
		<script src="src/main.js">
			print ( Foo             );
			print ( Foo 123         );
			print ( Foo (Bar 456)   );

			print [                 ];
			print [      1          ];
			print [      1,      2  ];
			print [      1,      2, ];

			print [ foo: 1          ];
			print [ foo: 1, bar: 2  ];
			print [ foo: 1, bar: 2, ];
		</script>
		-->

		<!--
		<h1>Indexing</h1>
		<script src="src/main.js">
			set lst  = ["zero","one","two","three"];
			set obj  = [zero:0, one:1, two:2];
			set nlst = [lst, obj];
			set nobj = [zero: lst, one: obj];

			set lst.1      = "ONE!";
			set nlst.1.one = "111";

			print (lst.1);
			print (lst.(1+1));
			print (obj.zero);
			print (nlst.1.one);
			print (nobj.zero.0);
		</script>
		-->

		<!--
		<h1>Closures</h1>
		<script src="src/main.js">
			def update lst: {
				set lst.4 = "four";
				lst;
			};
			set lst = ["zero","one","two","three"];
			set dup = update lst;
			print lst;
			print dup;
		</script>
		-->

		<!--
		<h1>Simple lists</h1>
		<script src="src/main.js">
			set a = [ val: "a" ];
			set b = [ val: "b" ];
			set c = [ val: "c" ];

			set a.next = b;
			set b.next = c;
			set c.next = a;

			print (a.val);
			print (a.next.val);
			print (a.next.next.val);
			print (a.next.next.next.val);

			set t = "end";
			set t = [ next: t ];
			set t = [ next: t ];

			print (t);
			print (t.next);
			print (t.next.next);
		</script>
		-->

		<!--
		<h1>Data functions</h1>
		<script src="src/main.js">
			def list: {
				set head = None;

				fun mesg -> match mesg with
					| Push val -> {
						set head = [
							val:  val,
							next: head,
						];
						val; }
					| Pop -> match head with
						| None -> None
						| list -> {
							set val  = head.val;
							set head = head.next;
							val; }
					| Get -> match head with
						| None -> None
						| list -> list.val;
			};

			set nums = list();
			set strs = list();

			nums(Push 1); strs(Push "one");
			nums(Push 2); strs(Push "two");

			print ((nums Pop) + " -> " + (strs Pop));
			print ((nums Pop) + " -> " + (strs Pop));
			print ((nums Pop) + " -> " + (strs Pop));
		</script>
		-->

		<!--
		<h1>Records</h1>
		<script src="src/main.js">
			# Hello, World
			print ( "hello: " + 123 ) ;

			# Simple functions
			set num = 1;
			set inc = fun -> set num = num + 1;

			print ( "inc:  " + inc() ) ;
			print ( "inc:  " + inc() ) ;
			print ( "num:  " + num   ) ;
		</script>
		-->

		<!--
		<h1>Recursion</h1>
		<script src="src/main.js">
			set sum = fun n ->
				match n with
					| 0 -> 0
					| _ -> n + (sum (n-1));
			sum 5;
		</script>
		-->

		<!--
		<h1>Counters</h1>
		<script src="src/main.js">
			set ctr = fun n ->
				fun -> set n = n + 1;
			set c1 = ctr 10;
			set c2 = ctr 20;

			print("c1: "+c1()+" -> "+c1()+" -> "+c1());
			print("c2: "+c2()+" -> "+c2()+" -> "+c2());
			print("c1: "+c1()+" -> "+c1()+" -> "+c1());
		</script>
		-->

		<!--
		<h1>Match</h1>
		<script src="src/main.js">
			match None with
				| Some 0 -> print ("some: zero")
				| Some n -> print ("some: " + n)
				| None   -> print "none"
				| _      -> print "unknown";
		</script>
		-->

		<!--
		<h1>Iterators</h1>
		<script src="src/main.js">
			def range lo hi:
				fun ->
					if (lo <= hi) {
						set out = lo;
						set lo  = lo+1;
						Some out;
					} None;

			def map iter body:
				fun ->
					match iter() with
						| Some x -> Some (body x)
						| None   -> None;

			def zip a b:
				fun ->
					match [a(), b()] with
						| [Some x, Some y] -> Some [x, y]
						| [None,   None  ] -> None;

			def foreach iter body:
				match iter() with
					| Some x -> { body x; foreach iter body; }
					| None   -> [];


			set nums = range 2 4;
			foreach nums as num:
				print ("num: " + num);

			set dbls = map nums as item: item * 2;
			foreach dbls as dbl:
				print ("dbl: " + dbl);

			set both = zip nums dbls;
			foreach both as arr:
				match arr with
					| [x, y] -> print ("x="+x+", y="+y);
		</script>
		-->

		<!--
		<h1>Thoughts</h1>
		<h2>Recursion</h2>
		<script src="embed.js?ft=inside,nu">
			set num   = 0;
			set count = fun ->
				if (num < 10)
					count();
				set num = num+1;
			count();
		</script>

		<h2>Conditionals</h2>
		<script src="embed.js?ft=inside,nu">
			# Conditionals
			set true = fun then else ->
				then();
			set false = fun then else ->
				else();
			set if = cond then else ->
				cond then else;
		</script>

		<h2>For Loops</h2>
		<script src="embed.js?ft=inside,nu">
			# Iterators - for each
			#    set tmp = range 0 2;
			#    tmp(); -> Some 0
			#    tmp(); -> Some 1
			#    tmp(); -> Some 2
			#    tmp(); -> None
			set range = fun lo hi ->
				set iter = fun ->
					set out = if (lo <= hi)
						( Some cur )
						( None     )
					set lo  = lo+1;
					out;

			set foreach = fun iter body ->
				match iter():
					Some x -> body(x);
					          foreach iter body;
					None   ->

			set fib = fun ->
				set a = 0;
				set b = 1;
				set iter = fun ->
					set o = a;
					set a = b;
					set b = o + b;
					Some o;

			foreach range(1,10) fun i ->
				print i
		</script>

		<h2>Iterators</h2>
		<script src="embed.js?ft=inside,nu">
			# Iterators - for loop
			set for = init cond step body state=null ->
				if cond(state)
					{ set state = body(state);
					  set next  = step(init);
					  for next cond step body state; }
					{ state; }

			while 0, <10, +1, +, 0
			while 0, {i|i<10}, {i|i+1}, {s,i|s+i}, 0
		</script>
		-->
	</body>
</html>
